# Enhanced tmux configuration with backtick as prefix
# Place this in ~/.tmux.conf

# ==========================
# General Settings
# ==========================

# Change prefix from Ctrl-b to backtick (`)
unbind C-b
set-option -g prefix `
bind ` send-prefix  # Press ` twice to send actual backtick

# Enable mouse support for scrolling and pane selection
set -g mouse on

# Start window and pane numbering at 1 (more intuitive)
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Increase history limit
set -g history-limit 10000

# Enable 256 colors
set -g default-terminal "screen-256color"

# Faster command sequences (no delay after escape)
set -sg escape-time 0

# Enable vi mode for copy mode
setw -g mode-keys vi

# ==========================
# Window Management
# ==========================

# `c - Create new window
bind c new-window -c "#{pane_current_path}"

# `n/`p - Next/Previous window
bind n next-window
bind p previous-window

# `1-9 - Direct window switching
# (Already works by default with prefix)

# `w - List windows (interactive selection)
bind w choose-window

# `, - Rename current window
bind , command-prompt -p "rename window:" "rename-window '%%'"

# `x - Kill current window (with confirmation)
bind x confirm-before -p "kill window #W? (y/n)" kill-window

# ==========================
# Pane Management
# ==========================

# `| - Split pane horizontally (creates vertical line)
bind | split-window -h -c "#{pane_current_path}"

# `- - Split pane vertically (creates horizontal line)
bind - split-window -v -c "#{pane_current_path}"

# `h/j/k/l - Navigate panes (vim-style)
bind h select-pane -L  # Move left
bind j select-pane -D  # Move down
bind k select-pane -U  # Move up
bind l select-pane -R  # Move right

# `H/J/K/L - Resize panes (shift + vim keys)
bind -r H resize-pane -L 5  # Resize left
bind -r J resize-pane -D 5  # Resize down
bind -r K resize-pane -U 5  # Resize up
bind -r L resize-pane -R 5  # Resize right

# `Space - Toggle between pane layouts
bind Space next-layout

# `z - Zoom/unzoom current pane (fullscreen toggle)
bind z resize-pane -Z

# `q - Kill current pane
bind q kill-pane

# `! - Break pane into new window
bind ! break-pane

# `m - Move pane to new window
bind m command-prompt -p "move pane to window:" "join-pane -t '%%'"

# ==========================
# Copy Mode
# ==========================

# `[ - Enter copy mode (scroll/select text)
bind [ copy-mode

# `v - Begin selection in copy mode (vi-style)
bind -T copy-mode-vi v send-keys -X begin-selection

# `y - Copy selection to clipboard
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# `] - Paste from tmux buffer
bind ] paste-buffer

# `= - List paste buffers and select one to paste
bind = choose-buffer

# ==========================
# Session Management
# ==========================

# `s - List sessions (interactive selection)
bind s choose-session

# `$ - Rename current session
bind '$' command-prompt -p "rename session:" "rename-session '%%'"

# `d - Detach from current session
# (Already works by default)

# `D - Detach other clients
bind D detach-client -a

# `( and `) - Switch to previous/next session
bind '(' switch-client -p
bind ')' switch-client -n

# ==========================
# Quick Actions
# ==========================

# `r - Reload tmux configuration
bind r source-file ~/.tmux.conf \; display-message "Config reloaded!"

# `t - Show time in current pane
bind t clock-mode

# `i - Display pane information
bind i display-panes

# `? - Show all key bindings (help)
bind ? list-keys

# `e - Edit tmux config in default editor
bind e new-window -n 'tmux-config' "sh -c '\${EDITOR:-vim} ~/.tmux.conf'"

# `S - Synchronize panes (type in all panes simultaneously)
bind S setw synchronize-panes \; display-message "Sync panes: #{?synchronize-panes,ON,OFF}"

# ==========================
# Status Bar Configuration
# ==========================

# Enable status bar
set -g status on

# Update status bar every second
set -g status-interval 1

# Status bar colors
set -g status-style bg=colour235,fg=colour136

# Left side of status bar
set -g status-left-length 30
set -g status-left '#[fg=colour40][#S] #[fg=colour226]#(whoami)@#h '

# Right side of status bar
set -g status-right-length 60
set -g status-right '#[fg=colour226]%Y-%m-%d #[fg=colour40]%H:%M:%S '

# Window status format
setw -g window-status-format '#[fg=colour244]#I:#W'
setw -g window-status-current-format '#[fg=colour40,bold]#I:#W*'

# Pane border colors
set -g pane-border-style fg=colour238
set -g pane-active-border-style fg=colour40

# Message colors
set -g message-style bg=colour235,fg=colour166

# ==========================
# Activity Monitoring
# ==========================

# Highlight window with activity
setw -g monitor-activity on
set -g visual-activity off  # Don't show message, just highlight

# Window with activity color
setw -g window-status-activity-style fg=colour196

# ==========================
# Advanced Features
# ==========================

# Enable focus events (useful for vim)
set -g focus-events on

# Word separators for double-click selection
set -g word-separators " -_@"

# Aggressive resize (useful when sharing sessions)
setw -g aggressive-resize on

# ==========================
# Quick Reference (after pressing `)
# ==========================
# Window Management:
#   c        - new window
#   n/p      - next/previous window
#   1-9      - switch to window N
#   w        - list windows
#   ,        - rename window
#   x        - kill window
#
# Pane Management:
#   |        - split horizontal
#   -        - split vertical
#   h/j/k/l  - navigate panes
#   H/J/K/L  - resize panes
#   z        - zoom pane
#   q        - kill pane
#   Space    - toggle layouts
#
# Copy Mode:
#   [        - enter copy mode
#   v        - begin selection
#   y        - copy selection
#   ]        - paste
#
# Sessions:
#   s        - list sessions
#   $        - rename session
#   d        - detach
#   (/)      - prev/next session
#
# Other:
#   r        - reload config
#   ?        - show all bindings
#   S        - sync panes toggle
