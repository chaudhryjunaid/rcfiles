# Modern tmux configuration with C-Space as prefix
# Place in ~/.tmux.conf

# =====================================
# CORE SETTINGS
# =====================================

# Remove default prefix and set it to Ctrl+Space
unbind C-b
set -g prefix C-Space
bind C-Space send-prefix

# Enable mouse support
set -g mouse on

# Start windows and panes at 1 instead of 0
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Increase history limit
set -g history-limit 50000

# Enable 256 colors and true color support
set -g default-terminal "screen-256color"
set-option -sa terminal-overrides ",xterm-256color:RGB"

# Faster escape time (for vim)
set -sg escape-time 0

# Focus events (for vim autoread)
set -g focus-events on

# Enable clipboard
set -g set-clipboard on

# =====================================
# KEY BINDINGS
# =====================================

# Reload config with r
bind r source-file ~/.tmux.conf \; display-message "Config reloaded!"

# Double tap Space for last window
bind Space last-window

# ---- Pane Management ----

# Split panes using | and - (more intuitive)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# Vim-style pane navigation
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Quick pane switching with Alt+arrows (no prefix needed)
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Resize panes with Ctrl+arrows (repeatable)
bind -r C-Left resize-pane -L 5
bind -r C-Right resize-pane -R 5
bind -r C-Up resize-pane -U 5
bind -r C-Down resize-pane -D 5

# Vim-style resize (repeatable)
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Maximize/restore pane
bind m resize-pane -Z

# ---- Window Management ----

# Create new window with current path
bind c new-window -c "#{pane_current_path}"

# Quick window switching with Alt+number (no prefix needed)
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9

# Move windows left/right
bind -r < swap-window -t -1 \; select-window -t -1
bind -r > swap-window -t +1 \; select-window -t +1

# ---- Copy Mode (vim-style) ----

# Use vim keybindings in copy mode
setw -g mode-keys vi

# Enter copy mode with v
bind v copy-mode

# Better copy mode bindings
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind -T copy-mode-vi Escape send-keys -X cancel

# Copy to system clipboard (macOS)
if-shell "uname | grep -q Darwin" {
    bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
    bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"
}

# ---- Session Management ----

# Quick session switching
bind S choose-session
bind N new-session

# Kill pane/window/session with confirmation
bind x kill-pane
bind X kill-window
bind Q confirm-before -p "Kill session #S? (y/n)" kill-session

# =====================================
# STATUS BAR
# =====================================

# Status bar position
set -g status-position bottom

# Status refresh interval
set -g status-interval 5

# Status bar colors
set -g status-style 'bg=#1e1e2e fg=#cdd6f4'

# Left side of status bar
set -g status-left-length 40
set -g status-left '#[fg=#89b4fa,bold]  #S #[fg=#45475a]│ '

# Right side of status bar
set -g status-right-length 60
set -g status-right '#[fg=#45475a]│#[fg=#f9e2af] %a %b %d #[fg=#45475a]│#[fg=#cba6f7] %H:%M '

# Window status format
setw -g window-status-format '#[fg=#6c7086] #I:#W '
setw -g window-status-current-format '#[fg=#89b4fa,bold] #I:#W#{?window_zoomed_flag, ,} '

# Message style
set -g message-style 'fg=#f9e2af bg=#1e1e2e bold'

# Pane borders
set -g pane-border-style 'fg=#45475a'
set -g pane-active-border-style 'fg=#89b4fa'

# Show prefix key press in status bar
set -g status-left '#[fg=#89b4fa,bold]  #S #[fg=#45475a]│#[fg=#f38ba8]#{?client_prefix, PREFIX ,}#[fg=#45475a]'

# =====================================
# PANE APPEARANCE
# =====================================

# Highlight active pane
set -g window-style 'bg=#1e1e2e'
set -g window-active-style 'bg=#181825'

# Display pane numbers longer
set -g display-panes-time 2000

# Pane number display colors
set -g display-panes-colour '#6c7086'
set -g display-panes-active-colour '#89b4fa'

# =====================================
# USEFUL FEATURES
# =====================================

# Automatically set window title
set -g automatic-rename on
set -g automatic-rename-format '#{b:pane_current_path}'

# Activity monitoring
setw -g monitor-activity on
set -g visual-activity off  # Don't show message, just highlight

# Word separators for copy mode
set -g word-separators " -_@"

# Allow programs to bypass tmux with their own scrolling
set -g alternate-screen on

# =====================================
# NESTED TMUX SESSIONS
# =====================================

# Use C-a for nested tmux sessions
bind -n C-a send-prefix

# =====================================
# PLUGINS (optional - requires TPM)
# =====================================

# List of plugins
# set -g @plugin 'tmux-plugins/tpm'
# set -g @plugin 'tmux-plugins/tmux-sensible'
# set -g @plugin 'tmux-plugins/tmux-resurrect'
# set -g @plugin 'tmux-plugins/tmux-continuum'
# set -g @plugin 'tmux-plugins/tmux-yank'

# Plugin settings
# set -g @resurrect-capture-pane-contents 'on'
# set -g @continuum-restore 'on'

# Initialize TPM (keep at bottom of file)
# run '~/.tmux/plugins/tpm/tpm'

# =====================================
# QUICK REFERENCE (PREFIX = Ctrl+Space)
# =====================================

# Prefix + ?     - Show all keybindings
# Prefix + r     - Reload config
# Prefix + Space - Last window
# Prefix + |     - Split vertical
# Prefix + -     - Split horizontal
# Prefix + h/j/k/l - Navigate panes (vim-style)
# Prefix + H/J/K/L - Resize panes (vim-style)
# Prefix + m     - Maximize/restore pane
# Prefix + c     - New window
# Prefix + ,     - Rename window
# Prefix + </>   - Move window left/right
# Prefix + v     - Enter copy mode
# Prefix + S     - Choose session
# Prefix + N     - New session
# Prefix + x     - Kill pane
# Prefix + X     - Kill window
# Prefix + Q     - Kill session
# 
# No prefix needed:
# Alt + Left/Right/Up/Down - Navigate panes
# Alt + 1-9                - Switch to window number