# Modern macOS-themed tmux configuration with backtick as prefix
# Place this in ~/.tmux.conf

# ==========================
# General Settings
# ==========================

# Change prefix from Ctrl-b to backtick (`)
unbind C-b
set-option -g prefix `
bind ` send-prefix  # Press ` twice to send actual backtick

# Enable mouse support for scrolling and pane selection
set -g mouse on

# Start window and pane numbering at 1 (more intuitive)
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Increase history limit
set -g history-limit 10000

# ==========================
# macOS Terminal Features
# ==========================

# Enable true color (24-bit) support for modern macOS terminals
set -g default-terminal "xterm-256color"
set -ga terminal-overrides ",xterm-256color:Tc"

# Enable undercurl support (for better vim/neovim integration)
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'

# macOS clipboard integration
set -g set-clipboard on

# Faster command sequences (no delay after escape)
set -sg escape-time 0

# Enable vi mode for copy mode
setw -g mode-keys vi

# Enable focus events (useful for vim)
set -g focus-events on

# ==========================
# Modern Theme & Colors
# ==========================

# Status bar general styling (transparent with subtle backdrop)
set -g status-style 'bg=#1e2030 fg=#c8d3f5'

# Status bar position
set -g status-position bottom

# Remove default status bar content for custom configuration
set -g status-left ''
set -g status-right ''

# Status bar left side - Session info with icon
set -g status-left-length 40
set -g status-left '#[fg=#82aaff,bg=#2f334d,bold] ⚡ #S #[fg=#2f334d,bg=#1e2030]'

# Status bar right side - Modern system info
set -g status-right-length 100
set -g status-right '#[fg=#2f334d,bg=#1e2030]#[fg=#c8d3f5,bg=#2f334d] 󰍛 #(pmset -g batt | grep -Eo "[0-9]+%%" || echo "AC") #[fg=#3e4451,bg=#2f334d]#[fg=#ffc777,bg=#3e4451]  %H:%M #[fg=#444a73,bg=#3e4451]#[fg=#86e1fc,bg=#444a73,bold]  %d %b '

# Window status separator
set -g window-status-separator ''

# Window status format (inactive)
setw -g window-status-format '#[fg=#1e2030,bg=#2f334d]#[fg=#828bb8,bg=#2f334d] #I  #W #[fg=#2f334d,bg=#1e2030]'

# Window status format (active) - with accent color
setw -g window-status-current-format '#[fg=#1e2030,bg=#82aaff]#[fg=#1e2030,bg=#82aaff,bold] #I  #W #[fg=#82aaff,bg=#1e2030]'

# Window status alignment
set -g status-justify left

# Pane borders - subtle and modern
set -g pane-border-style 'fg=#2f334d'
set -g pane-active-border-style 'fg=#82aaff'

# Pane number display styling
set -g display-panes-colour '#828bb8'
set -g display-panes-active-colour '#82aaff'

# Message styling (command prompt, etc.)
set -g message-style 'bg=#2f334d fg=#c8d3f5'
set -g message-command-style 'bg=#2f334d fg=#ffc777'

# Clock mode colors
setw -g clock-mode-colour '#82aaff'

# Copy mode highlighting
setw -g mode-style 'bg=#3e4451 fg=#c8d3f5'

# Bell
set -g visual-bell off
set -g visual-silence off
set -g bell-action none

# ==========================
# Window Management
# ==========================

# `c - Create new window
bind c new-window -c "#{pane_current_path}"

# `n/`p - Next/Previous window
bind n next-window
bind p previous-window

# `1-9 - Direct window switching
# (Already works by default with prefix)

# `w - List windows (interactive selection)
bind w choose-window

# `, - Rename current window
bind , command-prompt -p "rename window:" "rename-window '%%'"

# `x - Kill current window (with confirmation)
bind x confirm-before -p "kill window #W? (y/n)" kill-window

# ==========================
# Pane Management
# ==========================

# `| - Split pane horizontally (creates vertical line)
bind | split-window -h -c "#{pane_current_path}"

# `- - Split pane vertically (creates horizontal line)
bind - split-window -v -c "#{pane_current_path}"

# `h/j/k/l - Navigate panes (vim-style)
bind h select-pane -L  # Move left
bind j select-pane -D  # Move down
bind k select-pane -U  # Move up
bind l select-pane -R  # Move right

# `H/J/K/L - Resize panes (shift + vim keys)
bind -r H resize-pane -L 5  # Resize left
bind -r J resize-pane -D 5  # Resize down
bind -r K resize-pane -U 5  # Resize up
bind -r L resize-pane -R 5  # Resize right

# `Space - Toggle between pane layouts
bind Space next-layout

# `z - Zoom/unzoom current pane (fullscreen toggle)
bind z resize-pane -Z

# `q - Kill current pane
bind q kill-pane

# `! - Break pane into new window
bind ! break-pane

# `m - Move pane to new window
bind m command-prompt -p "move pane to window:" "join-pane -t '%%'"

# ==========================
# Copy Mode (macOS clipboard integration)
# ==========================

# `[ - Enter copy mode (scroll/select text)
bind [ copy-mode

# Setup 'v' to begin selection as in Vim
bind -T copy-mode-vi v send-keys -X begin-selection

# Setup 'y' to copy selection to macOS clipboard
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"

# Setup mouse drag to copy to macOS clipboard
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"

# `] - Paste from tmux buffer
bind ] paste-buffer

# `= - List paste buffers and select one to paste
bind = choose-buffer

# Double-click to select and copy word
bind -T copy-mode-vi DoubleClick1Pane select-pane \; send-keys -X select-word \; send-keys -X copy-pipe-and-cancel "pbcopy"

# Triple-click to select and copy line
bind -T copy-mode-vi TripleClick1Pane select-pane \; send-keys -X select-line \; send-keys -X copy-pipe-and-cancel "pbcopy"

# ==========================
# Session Management
# ==========================

# `s - List sessions (interactive selection)
bind s choose-session

# `$ - Rename current session
bind '$' command-prompt -p "rename session:" "rename-session '%%'"

# `d - Detach from current session
# (Already works by default)

# `D - Detach other clients
bind D detach-client -a

# `( and `) - Switch to previous/next session
bind '(' switch-client -p
bind ')' switch-client -n

# ==========================
# Quick Actions
# ==========================

# `r - Reload tmux configuration with notification
bind r source-file ~/.tmux.conf \; display-message " Config reloaded!"

# `t - Show time in current pane
bind t clock-mode

# `i - Display pane information
bind i display-panes

# `? - Show all key bindings (help)
bind ? list-keys

# `e - Edit tmux config in default editor
bind e new-window -n 'tmux-config' "sh -c '\${EDITOR:-vim} ~/.tmux.conf'"

# `S - Synchronize panes (type in all panes simultaneously)
bind S setw synchronize-panes \; display-message "Sync panes: #{?synchronize-panes,ON,OFF}"

# `b - Toggle status bar visibility
bind b set -g status \; display-message "Status bar: #{?status,ON,OFF}"

# ==========================
# Status Bar Configuration
# ==========================

# Enable status bar
set -g status on

# Update status bar every 2 seconds
set -g status-interval 2

# Center window list
set -g status-justify left

# ==========================
# Activity Monitoring
# ==========================

# Highlight window with activity (subtle)
setw -g monitor-activity on
set -g visual-activity off  # Don't show message, just highlight

# Window with activity styling
setw -g window-status-activity-style 'fg=#ffc777,bold'

# ==========================
# Advanced Features
# ==========================

# Word separators for double-click selection
set -g word-separators " -_@"

# Aggressive resize (useful when sharing sessions)
setw -g aggressive-resize on

# Enable OSC 52 clipboard (works over SSH)
set -g set-clipboard on

# Increase display time of pane numbers
set -g display-panes-time 2000

# ==========================
# Popup window styling (tmux 3.2+)
# ==========================

# Floating popup window style
set -g popup-style 'bg=#1e2030,fg=#c8d3f5'
set -g popup-border-style 'fg=#82aaff'

# ==========================
# Quick Reference (after pressing `)
# ==========================
# Window Management:
#   c        - new window
#   n/p      - next/previous window
#   1-9      - switch to window N
#   w        - list windows
#   ,        - rename window
#   x        - kill window
#
# Pane Management:
#   |        - split horizontal
#   -        - split vertical
#   h/j/k/l  - navigate panes
#   H/J/K/L  - resize panes
#   z        - zoom pane
#   q        - kill pane
#   Space    - toggle layouts
#
# Copy Mode (with macOS clipboard):
#   [        - enter copy mode
#   v        - begin selection
#   y        - copy to clipboard
#   ]        - paste
#
# Sessions:
#   s        - list sessions
#   $        - rename session
#   d        - detach
#   (/)      - prev/next session
#
# Other:
#   r        - reload config
#   b        - toggle status bar
#   ?        - show all bindings
#   S        - sync panes toggle
#
